(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{417:function(s,a,t){"use strict";t.r(a);var n=t(2),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"_1-初识docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-初识docker"}},[s._v("#")]),s._v(" 1. 初识docker")]),s._v(" "),a("p",[s._v("问题分析：我们写的代码会接触到好几个环境：开发环境、测试环境以及生产环境：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/715189cabb4a4532b20ccdff050f1bb1~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("h2",{attrs:{id:"_1-1-docker概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-docker概念"}},[s._v("#")]),s._v(" 1.1 docker概念")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c0f57e401f8b4e5f98c2f35fc796f62d~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("ul",[a("li",[s._v("Docker 是一个开源的应用容器引擎")]),s._v(" "),a("li",[s._v("诞生于 2013 年初，基于 Go 语言实现， dotCloud 公司出品（后改名为Docker Inc）")]),s._v(" "),a("li",[s._v("Docker 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上。")]),s._v(" "),a("li",[s._v("容器是完全使用沙箱机制，相互隔离 容器性能开销极低。")]),s._v(" "),a("li",[s._v("Docker 从 17.03 版本之后分为 CE（Community Edition: 社区版） 和 EE（Enterprise Edition: 企业版）")])]),s._v(" "),a("blockquote",[a("p",[s._v("总结：docker是一种容器技术，他解决容器款环境迁移问题")])]),s._v(" "),a("h1",{attrs:{id:"_1-2-docker安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-docker安装"}},[s._v("#")]),s._v(" 1.2 docker安装")]),s._v(" "),a("p",[s._v("Docker可以运行在MAC、Windows、CentOS、UBUNTU等操作系统上，本课程基于CentOS 7 安装Docker。\n官网：https://www.docker.com")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1、yum 包更新到最新 ")]),s._v("\nyum update \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2、安装需要的软件包， yum-util 提供yum-config-manager功能，另外两个是devicemapper驱动依赖的 ")]),s._v("\nyum install "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y yum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("utils device"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mapper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("persistent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("data lvm2 \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3、 设置yum源 ")]),s._v("\nyum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("manager "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("add"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("repo https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//download.docker.com/linux/centos/docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ce.repo \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4、 安装docker，出现输入的界面都按 y ")]),s._v("\nyum install "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ce \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5、 查看docker版本，验证是否验证成功 ")]),s._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("blockquote",[a("p",[s._v("镜像加速器")])]),s._v(" "),a("p",[s._v("阿里云镜像获取地址：https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors 登陆后，左侧菜单选中 镜像加速器就可以看到你的专属地址了：")]),s._v(" "),a("p",[s._v("在/etc/docker/daemon.json，文件末尾增加如下内容：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n    "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"registry-mirrors"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://你的ID.mirror.aliyuncs.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h1",{attrs:{id:"_2-docker架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-docker架构"}},[s._v("#")]),s._v(" 2. docker架构")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a142168a2bf14b39ab512fe2864d63aa~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("p",[a("strong",[s._v("镜像(Image）")]),s._v("：Docker 镜像（Image），就相当于是一个 root 文件系统。比如官方镜像 ubuntu:16.04 就包含了 完整的一套 Ubuntu16.04 最小系统的 root 文件系统。")]),s._v(" "),a("p",[a("strong",[s._v("容器（Container）")]),s._v("：镜像（Image）和容器（Container）的关系，就像是面向对象程序设计中的类和对象一样， 镜像是静态的定义，容器是镜像运行时的实体。容器可以被创建、启动、停止、删除、暂停等。")]),s._v(" "),a("p",[a("strong",[s._v("仓库（Repository")]),s._v("）：仓库可看成一个代码控制中心，用来保存镜像。")]),s._v(" "),a("h1",{attrs:{id:"_3-docker命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-docker命令"}},[s._v("#")]),s._v(" 3. docker命令")]),s._v(" "),a("h2",{attrs:{id:"_3-1-进程相关命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-进程相关命令"}},[s._v("#")]),s._v(" 3.1 进程相关命令")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动docker")]),s._v("\nsystemctl start docker\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止docker服务")]),s._v("\nsystemctl stop docker\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启docker服务")]),s._v("\nsystemctl restart docker\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看docker服务状态")]),s._v("\nsystemctl status docker\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置开机启动docker服务")]),s._v("\nsystemctl enable docker\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h2",{attrs:{id:"_3-2-镜像相关命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-镜像相关命令"}},[s._v("#")]),s._v(" 3.2 镜像相关命令")]),s._v(" "),a("p",[s._v("镜像命令包括如下内容：查看镜像、搜索镜像 、拉取镜像 、删除镜像")]),s._v(" "),a("blockquote",[a("p",[s._v("查看镜像: 查看本地所有的镜像")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker images \ndocker images –q "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看所用镜像的id")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/27f06c2422304ac5bce00eea15c81d6e~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("blockquote",[a("p",[s._v("搜索镜像:从网络中查找需要的镜像")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker search 镜像名称 \ndocker search redis "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查找redis镜像")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("blockquote",[a("p",[s._v("拉取镜像:从Docker仓库下载镜像到本地，镜像名称格式为 名称:版本号，如果版本号不指定则是最新的版本 lastest。")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker pull 镜像名称 \ndocker pull redis "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#下载最新版本")]),s._v("\nredis docker pull redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#下载6.0版本redis")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dbcd5a16880d4b72acffa3f20a7d6934~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("blockquote",[a("p",[s._v("删除镜像: 删除本地镜像")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker rmi 镜像id "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除指定本地镜像 ")]),s._v("\ndocker images "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("q "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看所有的镜像列表 ")]),s._v("\ndocker rmi `docker images "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("q` "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除所有本地镜像")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"_3-3-容器相关命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-容器相关命令"}},[s._v("#")]),s._v(" 3.3 容器相关命令")]),s._v(" "),a("p",[s._v("查看容器、创建容器、进入容器、启动容器、停止容器、删除容器、查看容器信息")]),s._v(" "),a("blockquote",[a("p",[s._v("查看容器")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker ps "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看正在运行的容器 ")]),s._v("\ndocker ps –a "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看所有容器")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b39bd1c8b4ea46628cfd50891e9f9138~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("blockquote",[a("p",[s._v("创建并启动容器")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker run 参数\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("参数说明：")]),s._v(" "),a("ul",[a("li",[s._v("-i：保持容器运行。通常与 -t 同时使用。加入it这两个参数后，容器创建后自动进入容器中，退出容器后，容 器自动关闭。")]),s._v(" "),a("li",[s._v("-t：为容器重新分配一个伪输入终端，通常与 -i 同时使用。")]),s._v(" "),a("li",[s._v("-d：以守护（后台）模式运行容器。创建一个容器在后台运行，需要使用docker exec 进入容器。退出后，容 器不会关闭。")]),s._v(" "),a("li",[s._v("-it 创建的容器一般称为交互式容器，-id 创建的容器一般称为守护式容器")]),s._v(" "),a("li",[s._v("--name：为创建的容器命名。")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("it "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name=c1 centos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("7 /bin/bash "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建交互式容器 ")]),s._v("\ndocker run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("id "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name=c2 centos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建守护式容器")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e745fbd0b1fb4e26a724dbc1ad897248~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}}),s._v(" "),a("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/235aca745dff4a34b2fe093b846f064c~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("blockquote",[a("p",[s._v("注意：交互式容器，exit后容器自动关闭，守护式容器会在后台执行\n进入容器")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker exec "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("it c2 /bin/bash "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入容器")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/30103aa862c242f698454ec3fb7e9b21~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("blockquote",[a("p",[s._v("停止容器")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker stop 容器名称\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/29e8cf91844f4fb3bafafef7fdf7c378~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("blockquote",[a("p",[s._v("启动容器")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker start 容器名称\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/abb34359969a483783da085d50470796~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("blockquote",[a("p",[s._v("删除容器：如果容器是运行状态则删除失败，需要停止容器才能删除")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker rm 容器名称\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/12eb45b4defb4ba383fb4f4a4fe60158~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("blockquote",[a("p",[s._v("查看容器信息")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker inspect 容器名称\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ee43c3560b1e4f958edc0806557be03e~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("h1",{attrs:{id:"_4-docker容器的数据卷"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-docker容器的数据卷"}},[s._v("#")]),s._v(" 4. Docker容器的数据卷")]),s._v(" "),a("h2",{attrs:{id:"_4-1-数据卷概念及作用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-数据卷概念及作用"}},[s._v("#")]),s._v(" 4.1 数据卷概念及作用")]),s._v(" "),a("p",[s._v("思考：")]),s._v(" "),a("ul",[a("li",[s._v("Docker 容器删除后，在容器中产生的数据还在吗？")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6f8d1a4daa4c4a9299e04a24e5b89a9e~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("ul",[a("li",[s._v("Docker 容器和外部机器可以直接交换文件吗？")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/62737d17739f4e6baf70e3ee28a194e4~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("ul",[a("li",[s._v("容器之间想要进行数据交互？")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/62bcab3b44b2419aa53805872f858b35~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("blockquote",[a("p",[s._v("数据卷概念")])]),s._v(" "),a("ul",[a("li",[s._v("数据卷是宿主机中的一个目录或文件")]),s._v(" "),a("li",[s._v("当容器目录和数据卷目录绑定后，对方的修改会立即同步")]),s._v(" "),a("li",[s._v("一个数据卷可以被多个容器同时挂载")]),s._v(" "),a("li",[s._v("一个容器也可以被挂载多个数据卷")])]),s._v(" "),a("blockquote",[a("p",[s._v("数据卷的作用")])]),s._v(" "),a("ul",[a("li",[s._v("容器数据持久化")]),s._v(" "),a("li",[s._v("外部机器和容器间接通信")]),s._v(" "),a("li",[s._v("容器之间数据交换")])]),s._v(" "),a("h2",{attrs:{id:"_4-2-配置数据卷"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-配置数据卷"}},[s._v("#")]),s._v(" 4.2 配置数据卷")]),s._v(" "),a("p",[s._v("创建启动容器时，使用 –v 参数 设置数据卷")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v(" –v 宿主机目录(文件)"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("容器内目录(文件) "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("blockquote",[a("p",[s._v("注意事项")])]),s._v(" "),a("ol",[a("li",[s._v("容器目录必须是绝对路径")]),s._v(" "),a("li",[s._v("如果目录不存在，会自动创建")]),s._v(" "),a("li",[s._v("可以挂载多个数据卷")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c60f52f11d5247f595fa27bcaf138302~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("ul",[a("li",[s._v("演示数据卷持久化")])]),s._v(" "),a("blockquote",[a("p",[s._v("创建c1挂载/root/data到/root/data_container")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("it "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name=c1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v /root/data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/root/data_container centos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("7 /bin/bash\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("blockquote",[a("p",[s._v("关闭容器，可以看到数据卷数据文件还在")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker stop c1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("宿主机目录还在")]),s._v(" "),a("blockquote",[a("p",[s._v("删除容器c1")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker rm c1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("宿主机目录还在")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0576d3c227af414fad42fe28d6bd5e17~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}}),s._v(" "),a("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d231dffc263a49e3ba68f2deb1b8be74~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("blockquote",[a("p",[s._v("重新恢复c1")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("it "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name=c1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v /root/data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/root/data_container centos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("7 /bin/bash\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9a60439518af485d9fd063eca7975b94~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}}),s._v("\n文件还是存在，证明了持久化。")]),s._v(" "),a("ul",[a("li",[s._v("演示一个容器挂载多个数据卷")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("it "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name=c2 \\ \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v ~/data2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/root/data2 \\ \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v ~/data3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/root/data3 \\ \ncentos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2fdece822e224502b7de0e27452e9cd7~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/342abcb8fa214f7ba3c18a195d3e8b9a~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/347d989c19044d18811be96a0b382d9d~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("ul",[a("li",[s._v("两个容器挂载同一个数据卷")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("it "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name=c3 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v /root/data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/root/data_container centos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("7 /bin/bash \ndocker run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("it "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name=c4 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v /root/data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/root/data_container centos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("7 /bin/bash\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("blockquote",[a("p",[s._v("在一个容器中修改文件，看到另一个容器也同步修改")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c7bdb0a288cd48b19112db17541707bd~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/20b008bcc822432095974e18402e8424~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("h2",{attrs:{id:"_4-3-配置数据卷容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-配置数据卷容器"}},[s._v("#")]),s._v(" 4.3 配置数据卷容器")]),s._v(" "),a("blockquote",[a("p",[s._v("多容器进行数据交换，多个容器挂载同一个数据卷容器，完成数据交互")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e1226b0d817a4974b37a3c591f1a9ea4~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("ol",[a("li",[s._v("创建启动c3数据卷容器，使用 –v 参数 设置数据卷")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker run –it "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name=c3 –v /volume centos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("7 /bin/bash\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这里没有指定宿主机目录，默认生成一个宿主机目录")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker inspect c3 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看c3")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fbe2619e104f4e6c8d32d43322ee0e77~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[s._v("创建启动 c1 c2 容器，使用 –-volumes-from 参数 设置数据卷")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("it "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name=c1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("volumes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("from c3 centos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("7 /bin/bash \ndocker run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("it "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name=c2 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("volumes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("from c3 centos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("7 /bin/bash\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("使用 c3数据卷容器创建c1,c2，这时即使c3关闭不影响c1,c2交互")]),s._v(" "),a("p",[s._v("数据卷小结")]),s._v(" "),a("ol",[a("li",[s._v("数据卷概念\n"),a("ul",[a("li",[s._v("宿主机的一个目录或文件")])])]),s._v(" "),a("li",[s._v("数据卷作用\n"),a("ul",[a("li",[s._v("容器数据持久化")]),s._v(" "),a("li",[s._v("客户端和容器数据交换")]),s._v(" "),a("li",[s._v("容器间数据交换\n3.数据卷容器")])])])]),s._v(" "),a("ul",[a("li",[s._v("创建一个容器，挂载一个目录，让其他容器继承自该容器( --volume-from )。")]),s._v(" "),a("li",[s._v("通过简单方式实现数据卷配置")])]),s._v(" "),a("h1",{attrs:{id:"_5-docker应用部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-docker应用部署"}},[s._v("#")]),s._v(" 5. Docker应用部署")]),s._v(" "),a("h2",{attrs:{id:"_5-1-mysql部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-mysql部署"}},[s._v("#")]),s._v(" 5.1 MYsql部署")]),s._v(" "),a("blockquote",[a("p",[s._v("分析")])]),s._v(" "),a("ul",[a("li",[s._v("容器内的网络服务和外部机器不能直接通信")]),s._v(" "),a("li",[s._v("外部机器和宿主机可以直接通信")]),s._v(" "),a("li",[s._v("宿主机和容器可以直接通信")]),s._v(" "),a("li",[s._v("当容器中的网络服务需要被外部机器访问时，可以将容器中提供服务的端口映射到宿主机的端口上。外部机 器访问宿主机的端口，从而间接访问容器的服务。")]),s._v(" "),a("li",[s._v("这种操作称为：端口映射")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c09215d3eece41a9970f3bbbceae3b6d~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("ol",[a("li",[s._v("搜索和拉取mysql镜像")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker search mysql "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#搜索mysql镜像")]),s._v("\ndocker pull mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.6")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拉取mysql镜像")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c14807eccdfc4d939aca1968ed21082e~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[s._v("创建容器，设置端口映射、目录映射")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在/root目录下创建mysql目录用于存储mysql数据信息 ")]),s._v("\nmkdir ~/mysql \ncd ~/mysql\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("id \\ \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p 3307"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("3306 \\ \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name=c_mysql \\ \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v $PWD/conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/etc/mysql/conf.d \\ \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v $PWD/logs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/logs \\ \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v $PWD/data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/var/lib/mysql \\ \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("e MYSQL_ROOT_PASSWORD=123456 \\ \nmysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.6")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("ul",[a("li",[s._v("参数说明：\n"),a("ul",[a("li",[s._v("-p 3307:3306：将容器的 3306 端口映射到宿主机的3307端口。")]),s._v(" "),a("li",[s._v("-v $PWD/conf:/etc/mysql/conf.d：将主机当前目录下的 conf/my.cnf 挂载到容器的 /etc/mysql/my.cnf。配置目录")]),s._v(" "),a("li",[s._v("-v $PWD/logs:/logs：将主机当前目录下的logs目录挂载到容器的/logs日志目录")]),s._v(" "),a("li",[s._v("-v $PWD/data:/var/lib/mysql ：将主机当前目录下的data目录挂载到容器的 /var/lib/mysql 。数据目录")]),s._v(" "),a("li",[s._v("-e MYSQL_ROOT_PASSWORD=123456：初始化root用户的密码。")])])])]),s._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[s._v("进入容器，操作mysql")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker exec "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("it c_mysql /bin/bash \nmysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("uroot "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p123456\nshow databases; \ncreate database db1;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ol",{attrs:{start:"5"}},[a("li",[s._v("使用外部机器连接容器中的mysql")])]),s._v(" "),a("h2",{attrs:{id:"_5-2-tomcat部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-tomcat部署"}},[s._v("#")]),s._v(" 5.2 Tomcat部署")]),s._v(" "),a("ol",[a("li",[s._v("搜索和拉取tomcat镜像")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker search tomcat\ndocker pull tomcat\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("创建容器，设置端口映射、目录映射")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在/root目录下创建tomcat目录用于存储tomcat数据信息 ")]),s._v("\nmkdir ~/tomcat \ncd ~/tomcat\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("id "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name=c_tomcat \\ \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p 8080"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8080 \\ \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v $PWD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/usr/local/tomcat/webapps \\ \ntomcat\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("参数说明：\n"),a("ul",[a("li",[s._v("-p 8080:8080：将容器的8080端口映射到主机的8080端口")]),s._v(" "),a("li",[s._v("-v $PWD:/usr/local/tomcat/webapps：将主机中当前目录挂载到容器的webapps")])])])]),s._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[s._v("使用外部机器访问tomcat")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/17a150010c224fdb9e872e4237a99dbd~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("h2",{attrs:{id:"_5-3-nginx部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-nginx部署"}},[s._v("#")]),s._v(" 5.3 Nginx部署")]),s._v(" "),a("ol",[a("li",[s._v("搜索并拉取nginx镜像")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker search nginx\ndocker pull nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("创建容器，设置端口映射、目录映射")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在/root目录下创建nginx目录用于存储nginx数据信息 ")]),s._v("\nmkdir ~/nginx \ncd ~/nginx \nmkdir conf cd conf \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在~/nginx/conf/下创建nginx.conf文件,粘贴下面内容 ")]),s._v("\nvim nginx.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("user  nginx; "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置nginx服务的系统使用用户")]),s._v("\nworker_processes  1; "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#工作进程数")]),s._v("\n\nerror_log  /var/log/nginx/error.log warn; "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#nginx的错误日志")]),s._v("\npid        /var/run/nginx.pid; "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#nginx启动时候的pid")]),s._v("\n\nevents "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    worker_connections  1024; "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#每个进程允许的最大连接数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nhttp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#http请求配置，一个http可以包含多个server")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义 Content-Type")]),s._v("\n    include       /etc/nginx/mime.types;\n    default_type  application/octet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("stream;\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#访问日志，后面的main表示使用log_format中的main格式记录到access.log中")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#日志格式 此处main与access_log中的main对应")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#$remote_addr：客户端地址")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#$remote_user：http客户端请求nginx认证的用户名，默认不开启认证模块，不会记录")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#$timelocal：nginx的时间")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#$request：请求method + 路由 + http协议版本")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#status：http reponse 状态码")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#body_bytes_sent：response body的大小")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#$http_referer：referer头信息参数，表示上级页面")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#$http_user_agent：user-agent头信息参数，客户端信息")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#$http_x_forwarded_for：x-forwarded-for头信息参数")]),s._v("\n    log_format  main  '$http_user_agent' '$remote_addr "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" $remote_user "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("$time_local"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(' "$request" \'\n                      \'$status $body_bytes_sent "$http_referer" \'\n                      \'"$http_user_agent" "$http_x_forwarded_for"\';\n\n    '),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#nginx的一大优势，高效率文件传输")]),s._v("\n    sendfile        on;\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#tcp_nopush     on;")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#客户端与服务端的超时时间，单位秒")]),s._v("\n    keepalive_timeout  65;\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#gzip  on;")]),s._v("\n\n    include /etc/nginx/conf.d/"),a("span",{pre:!0,attrs:{class:"token important"}},[s._v("*.conf;")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br")])]),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("id "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name=nginx \\\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p 80"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("80 \\ \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v $PWD/conf/nginx.conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/etc/nginx/nginx.conf \\ \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v $PWD/logs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/var/log/nginx \\ \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v $PWD/html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/usr/share/nginx/html \\ \nnginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.10")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("ul",[a("li",[s._v("参数说明：\n"),a("ul",[a("li",[s._v("-p 80:80：将容器的 80端口映射到宿主机的 80 端口。")]),s._v(" "),a("li",[s._v("-v $PWD/conf/nginx.conf:/etc/nginx/nginx.conf：将主机当前目录下的 /conf/nginx.conf 挂载到容器的 :/etc/nginx/nginx.conf。配置目录")]),s._v(" "),a("li",[s._v("-v $PWD/logs:/var/log/nginx：将主机当前目录下的 logs 目录挂载到容器的/var/log/nginx。日志目录")])])])]),s._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[s._v("使用外部机器访问nginx")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b4596219a48e4214a2dbde480780ee5c~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("h2",{attrs:{id:"_5-4-redis部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-redis部署"}},[s._v("#")]),s._v(" 5.4 Redis部署")]),s._v(" "),a("ol",[a("li",[s._v("搜索并拉取镜像")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker search redis\ndocker pull redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("创建容器，设置端口映射")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("id "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name=c_redis "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p 6379"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("6379 redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("使用外部机器连接redis")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cli "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("h 192.168.220.12 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p 6379 \nset id 100 \nget id\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cbf8db1f973b42f68426a9d13cb16308~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("h1",{attrs:{id:"_6-dockerfile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-dockerfile"}},[s._v("#")]),s._v(" 6. Dockerfile")]),s._v(" "),a("h2",{attrs:{id:"_6-1-docker镜像原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-docker镜像原理"}},[s._v("#")]),s._v(" 6.1 Docker镜像原理")]),s._v(" "),a("blockquote",[a("p",[s._v("操作系统组成部分：")])]),s._v(" "),a("ul",[a("li",[s._v("进程调度子系统")]),s._v(" "),a("li",[s._v("进程通信子系统")]),s._v(" "),a("li",[s._v("内存管理子系统")]),s._v(" "),a("li",[s._v("设备管理子系统")]),s._v(" "),a("li",[s._v("文件管理子系统")]),s._v(" "),a("li",[s._v("网络通信子系统")]),s._v(" "),a("li",[s._v("作业控制子系统")])]),s._v(" "),a("blockquote",[a("p",[s._v("Linux文件系统由bootfs和rootfs两部分组成")])]),s._v(" "),a("ul",[a("li",[s._v("bootfs：包含bootloader（引导加载程序）和 kernel（内核）")]),s._v(" "),a("li",[s._v("rootfs： root文件系统，包含的就是典型 Linux 系统中的/dev，/proc，/bin，/etc等标准目录和文件")]),s._v(" "),a("li",[s._v("不同的linux发行版，bootfs基本一样，而rootfs不同，如ubuntu，centos等")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fa2c3eed0b5d4c23b06bb25c6eeb2662~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("blockquote",[a("p",[s._v("docker镜像原理\nDocker镜像是由特殊的文件系统叠加而成")])]),s._v(" "),a("ul",[a("li",[s._v("最底端是 bootfs，并使用宿主机的bootfs")]),s._v(" "),a("li",[s._v("第二层是 root文件系统rootfs,称为base image 然后再往上可以叠加其他的镜像文件")]),s._v(" "),a("li",[s._v("统一文件系统（Union File System）技术能够将不同的层整合成一个文件系统，为这些层提供了一个统一的视角，这样就隐藏了多层的存在，在用户的角度看来，只存在一个文件系统。")]),s._v(" "),a("li",[s._v("一个镜像可以放在另一个镜像的上面。位于下面的镜像称为父镜像，最底部的镜像成为基础镜像。")]),s._v(" "),a("li",[s._v("当从一个镜像启动容器时，Docker会在最顶层加载一个读写文件系统作为容器")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ca5739774a31484e93f323e2c0c352da~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("blockquote",[a("ol",[a("li",[s._v("Docker 镜像本质是什么？")])])]),s._v(" "),a("p",[s._v("是一个分层文件系统")]),s._v(" "),a("blockquote",[a("ol",{attrs:{start:"2"}},[a("li",[s._v("Docker 中一个centos镜像为什么只有200MB，而一个centos操作系统的iso文件要几个个G？")])])]),s._v(" "),a("p",[s._v("Centos的iso镜像文件包含bootfs和rootfs，而docker的centos镜像复用操作系统的bootfs，只有rootfs和其他镜像层")]),s._v(" "),a("blockquote",[a("ol",{attrs:{start:"3"}},[a("li",[s._v("Docker 中一个tomcat镜像为什么有600MB，而一个tomcat安装包只有70多MB？")])])]),s._v(" "),a("p",[s._v("由于docker中镜像是分层的，tomcat虽然只有70多MB，但他需要依赖于父镜像和基础镜像，所有整个对外暴露的tomcat镜像大小600多MB")]),s._v(" "),a("h2",{attrs:{id:"_6-2-镜像制作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-镜像制作"}},[s._v("#")]),s._v(" 6.2 镜像制作")]),s._v(" "),a("h3",{attrs:{id:"_6-2-1-容器转镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-1-容器转镜像"}},[s._v("#")]),s._v(" 6.2.1 容器转镜像")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker commit 容器id 镜像名称"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("版本号\ndocker save "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("o 压缩文件名称 镜像名称"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("版本号 \ndocker load –i 压缩文件名称\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e46925986bc04eb3bcf5599d4cdab81c~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入tomcat镜像")]),s._v("\ndocker exec "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("it c_tomcat /bin/bash\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建a.txt b.txt ")]),s._v("\ncd ~ \ntouch a.txt b.txt\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#容器转镜像 ")]),s._v("\ndocker commit 28b8d4dc9744 aaa_tomcat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#压缩镜像 ")]),s._v("\ndocker save "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("o lxs_tomcat.tar aaa_tomcat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除原来镜像 ")]),s._v("\ndocker rmi aaa_tomcat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#从压缩文件加载镜像 ")]),s._v("\ndocker load "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("i aaa_tomcat.tar \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#产生镜像 ")]),s._v("\ndocker run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("it "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name=new_tomcat lxs_tomcat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("1.0 /bin/bash \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入查看内容 ")]),s._v("\ndocker exec "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("it c_tomcat /bin/bash \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#可以看到a.txt b.txt存在，而webapps/test不存在")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f629801d5a374429848296ac1037ae59~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/de610130ff484e019d291eede91b29e0~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d97dd2e65a424b69ac790d7539cdcdb8~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9041be58ffac442bbc8739ddc74969e8~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("h3",{attrs:{id:"_6-2-2-dockerfile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-2-dockerfile"}},[s._v("#")]),s._v(" 6.2.2 Dockerfile")]),s._v(" "),a("blockquote",[a("p",[s._v("概念")])]),s._v(" "),a("ul",[a("li",[s._v("Dockerfile 是一个文本文件")]),s._v(" "),a("li",[s._v("包含了一条条的指令")]),s._v(" "),a("li",[s._v("每一条指令构建一层，基于基础镜像，最终构建出一个新的镜像")]),s._v(" "),a("li",[s._v("对于开发人员：可以为开发团队提供一个完全一致的开发环境")]),s._v(" "),a("li",[s._v("对于测试人员：可以直接拿开发时所构建的镜像或者通过Dockerfile文件构建一个新的镜像开始工作了")]),s._v(" "),a("li",[s._v("对于运维人员：在部署时，可以实现应用的无缝移植")])]),s._v(" "),a("p",[s._v("参考Dochub网址：https://hub.docker.com ，比如centos和nginx镜像")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/176330d1de0749bead60188a640a246e~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("blockquote",[a("p",[s._v("案例一：自定义centos7镜像")])]),s._v(" "),a("p",[s._v("要求：")]),s._v(" "),a("ol",[a("li",[s._v("默认登录路径为 /usr")]),s._v(" "),a("li",[s._v("可以使用vim")])]),s._v(" "),a("p",[s._v("实现步骤")]),s._v(" "),a("ul",[a("li",[s._v("定义父镜像：FROM centos:7")]),s._v(" "),a("li",[s._v("定义作者信息：MAINTAINER xxx xxxx")]),s._v(" "),a("li",[s._v("执行安装vim命令： RUN yum install -y vim")]),s._v(" "),a("li",[s._v("定义默认的工作目录：WORKDIR /usr")]),s._v(" "),a("li",[s._v("定义容器启动执行的命令：CMD /bin/bash")]),s._v(" "),a("li",[s._v("通过dockerfile构建镜像：docker build –f dockerfile文件路径 –t 镜像名称:版本 .")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#具体代码 ")]),s._v("\nmkdir ~/docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("files \ncd ~/docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("files \nvim centos_dockerfile\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("dockerfile具体内容")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("FROM centos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" \nMAINTAINER zjl \nRUN yum install "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y vim \nWORKDIR /usr C\nMD /bin/bash\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("build")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker build "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f ./centos_dockerfile "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("t zjl_centos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("1 .\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("-f：镜像文件")]),s._v(" "),a("li",[s._v("-t：新镜像名")]),s._v(" "),a("li",[s._v(". 寻址路径")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入看效果 ")]),s._v("\ndocker run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("it "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name=zjl zjl_centos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3a088bd1c9824dc5b2ca77e56860849d~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("blockquote",[a("p",[s._v("案例二：发布springboot项目")])]),s._v(" "),a("blockquote",[a("p",[s._v("HelloController")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RestController")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HelloController")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RequestMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/hello"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("hello")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n         "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello docker spring boot..."')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("blockquote",[a("p",[s._v("打包jar")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e8731add823e42f2bdff1ae6aee1cd3e~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/acfe32a352974d8eb6e889efa67d2ec8~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("ul",[a("li",[s._v("定义父镜像：FROM java:8")]),s._v(" "),a("li",[s._v("定义作者信息：MAINTAINER zjl zjl@163.com")]),s._v(" "),a("li",[s._v("将jar包添加到容器： ADD springboot.jar app.jar")]),s._v(" "),a("li",[s._v('定义容器启动执行的命令：CMD ["java","-jar","app.jar"]')]),s._v(" "),a("li",[s._v("通过dockerfile构建镜像：docker build –f dockerfile文件路径 –t 镜像名称:版本 .")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#springboot_dockerfile")]),s._v("\nFROM java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\nMAINTAINER zjl\nADD springboot.jar app.jar \nCMD "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-jar"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"app.jar"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("build")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker build –f ./springboot_dockerfile –t app .\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4a0ad8e261dd418887b5f8eaaa6298cd~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("id "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p 9000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8080 app\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2878af22733b4aa68ac0021402472ddb~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0acdc6e4f6894111a37fa6637009ba39~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("h1",{attrs:{id:"_7-服务编排"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-服务编排"}},[s._v("#")]),s._v(" 7. 服务编排")]),s._v(" "),a("h2",{attrs:{id:"_7-1-概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-概念"}},[s._v("#")]),s._v(" 7.1 概念")]),s._v(" "),a("p",[s._v("微服务架构的应用系统中一般包含若干个微服务，每个微服务一般都会部署多个实例，如果每个微服务都要手动启动停止，维护的工作量会很大。来看下我们日常工作：")]),s._v(" "),a("ul",[a("li",[s._v("要从Dockerfile build image 或者去dockerhub拉取image")]),s._v(" "),a("li",[s._v("要创建多个container")]),s._v(" "),a("li",[s._v("要管理这些container（启动停止删除）\n通过服务编排可以大量简化上面的工作服务编排：按照一定的业务规则批量管理容器")])]),s._v(" "),a("h2",{attrs:{id:"_7-2-docker-compose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-docker-compose"}},[s._v("#")]),s._v(" 7.2 Docker Compose")]),s._v(" "),a("p",[s._v("Docker Compose是一个编排多容器分布式部署的工具，提供命令集中管理容器化应用的完整开发周期，包括服务构建，启动和停止。使用步骤：")]),s._v(" "),a("ol",[a("li",[s._v("利用 Dockerfile 定义运行环境镜像")]),s._v(" "),a("li",[s._v("使用 docker-compose.yml 定义组成应用的各服务")]),s._v(" "),a("li",[s._v("运行 docker-compose up 启动应用")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b74b42aaff9a4882a19f742277216c5c~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("h3",{attrs:{id:"_7-2-1-安装docker-compose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-1-安装docker-compose"}},[s._v("#")]),s._v(" 7.2.1 安装Docker Compose")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Compose目前已经完全支持Linux、Mac OS和Windows，在我们安装Compose之前，需要先安装Docker。下面我 们以 编译好的二进制包方式安装在Linux系统中。 ")]),s._v("\ncurl "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("L https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//github.com/docker/compose/releases/download/1.22.0/docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("compose"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("`uname "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s`"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" `uname "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("m` "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("o /usr/local/bin/docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("compose \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置文件可执行权限 ")]),s._v("\nchmod +x /usr/local/bin/docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("compose \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看版本信息 ")]),s._v("\ndocker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("compose "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("version\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"_7-2-2-卸载docker-compose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-2-卸载docker-compose"}},[s._v("#")]),s._v(" 7.2.2 卸载Docker Compose")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 二进制包方式安装的，删除二进制文件即可 ")]),s._v("\nrm /usr/local/bin/docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("compose\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"_7-3-编排nginx-springboot"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-编排nginx-springboot"}},[s._v("#")]),s._v(" 7.3 编排nginx+springboot")]),s._v(" "),a("blockquote",[a("p",[s._v("编排nginx+springboot")])]),s._v(" "),a("ol",[a("li",[s._v("创建docker-compose目录")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("mkdir ~/docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("compose \ncd ~/docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("compose\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("编写 docker-compose.yml 文件")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nginx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 宿主机80端口映射容器80端口")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token datetime number"}},[s._v("80:80")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# links在当前容器中连接app容器 可以用app别名访问app容器 ")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("links")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" app\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将./nginx/conf.d数据卷目录挂载到/etc/nginx/conf.d ")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx做的方向代理的配置就在./nginx/conf.d目录中")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./nginx/conf.d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/etc/nginx/conf.d\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" app\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("expose")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8080"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("创建./nginx/conf.d目录")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("mkdir "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p ./nginx/conf.d\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("在./nginx/conf.d目录下编写app.conf文件")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    listen 80;\n    access_log off;\n  \n    location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用app别名访问springboot应用")]),s._v("\n      proxy_pass http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8080/hello;\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("ol",{attrs:{start:"5"}},[a("li",[s._v("在~/docker-compose 目录下使用docker-compose启动容器")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("compose up "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("d "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -d表示已守护模式启动")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/abd52c128598463080a4b870873ee497~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("ol",{attrs:{start:"6"}},[a("li",[s._v("测试访问")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/99073bf885af4de9bb321f3163847095~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("h1",{attrs:{id:"_8-私有仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-私有仓库"}},[s._v("#")]),s._v(" 8. 私有仓库")]),s._v(" "),a("h2",{attrs:{id:"_8-1-私有仓库搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-私有仓库搭建"}},[s._v("#")]),s._v(" 8.1 私有仓库搭建")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('# 1、拉取私有仓库镜像\ndocker pull registry\n# 2、启动私有仓库容器\ndocker run -id --name=registry -p 5000:5000 registry\n# 3、打开浏览器 输入地址http://私有仓库服务器ip:5000/v2/_catalog，看到{"repositories":[]} 表示私有仓\n库 搭建成功\n# 4、修改daemon.json\nvim /etc/docker/daemon.json\n# 在上述文件中添加一个key，保存退出。此步用于让 docker 信任私有仓库地址；注意将私有仓库服务器ip修改为自\n己私有仓库服务器真实ip\n{\n\t"registry-mirrors": ["https://你的ID.mirror.aliyuncs.com"]\n    "insecure-registries":["私有仓库服务器ip:5000"]\n}\n# 5、重启docker 服务\nsystemctl restart docker\ndocker start registry\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("h2",{attrs:{id:"_8-2-将镜像上传至私有仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-将镜像上传至私有仓库"}},[s._v("#")]),s._v(" 8.2 将镜像上传至私有仓库")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 1、标记镜像为私有仓库的镜像\ndocker tag centos:7 ip:5000/centos:7\n# 2、上传标记的镜像\ndocker push ip:5000/centos:7\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"_8-3-从私有仓库拉取镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-3-从私有仓库拉取镜像"}},[s._v("#")]),s._v(" 8.3 从私有仓库拉取镜像")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("#拉取镜像\ndocker pull ip:5000/centos:7\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);